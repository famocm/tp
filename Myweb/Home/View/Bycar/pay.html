<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0 ,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>结算页面</title>

		<link href="__PUBLIC__/Homes/AmazeUI-2.4.2/assets/css/amazeui.css" rel="stylesheet" type="text/css" />

		<link href="__PUBLIC__/Homes/basic/css/demo.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/Homes/css/cartstyle.css" rel="stylesheet" type="text/css" />

		<!-- head -->
		<link rel="Shortcut Icon" href="__PUBLIC__/Homes/images/icon.jpg" type="image/x-icon">
		<link href="__PUBLIC__/Homes/basic/css/demo.css" rel="stylesheet" type="text/css" type="text/css"/>
		<link href="__PUBLIC__/Homes/css/hmstyle.css" rel="stylesheet" type="text/css"/>
		<link href="__PUBLIC__/Homes/css/skin.css" rel="stylesheet" type="text/css" />
		<script src="__PUBLIC__/Homes/AmazeUI-2.4.2/assets/js/jquery.min.js"></script>
		<script src="__PUBLIC__/Homes/AmazeUI-2.4.2/assets/js/amazeui.min.js"></script>
		<link href="__PUBLIC__/Homes/css1/index_002.css" rel="stylesheet" type="text/css" />
		<!-- head -->

		<link href="__PUBLIC__/Homes/css/jsstyle.css" rel="stylesheet" type="text/css" />

		<script type="text/javascript" src="__PUBLIC__/Homes/js/address.js"></script>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Homes/css2/index.css">
		<link media="all" href="__PUBLIC__/Homes/css/index.css" type="text/css" rel="stylesheet">
		<script type="text/javascript" src="__PUBLIC__/Homes/js/jquery-1.8.3.min.js"></script>

	</head>

	<body>

		<!--顶部导航条 -->
		<div class="am-container header">
			<!-- 导入头部 -->
			<!-- 头部 -->
			<include file="Public/sshead"/>
			<!-- 头部 -->
			
			</div>

			<!--悬浮搜索框-->


			<div class="clear"></div>
			<div class="concent">
				<!--地址 -->
				<div class="paycont">
					<div class="address">
						<h3>确认收货地址 </h3>
						<div class="control">
							<div class="tc-btn createAddr theme-login am-btn am-btn-danger">添加收货地址</div>
						</div>
						<div class="clear"></div>
						<ul>

							<!-- <div class="per-border"></div> -->
							<foreach name="address" item="addresses">
							<li class="user-addresslist" name="{$addresses['id']}" id="li">

								<div class="address-left">
									<div class="user DefaultAddr">

										<span class="buy-address-detail">   
                   						<span class="buy-user">{$addresses['name']} </span>
										<span class="buy-phone">{$addresses['phone']}</span>
										</span>
									</div>
									<div class="default-address DefaultAddr">
										<span class="buy-line-title buy-line-title-type">收货地址：</span>
										<span class="buy--address-detail">
								  <!--  <span class="province">湖北</span>省
										<span class="city">武汉</span>市
										<span class="dist">洪山</span>区 -->
										<span>{$addresses['address']}</span>
										<span class="street">{$addresses['street']}</span>
										</span>

										</span>
									</div>
									<!-- <ins class="deftip">默认地址</ins> -->
								</div>
								<div class="address-right">
									<a href="__PUBLIC__/Homes/person/address.html">
										<span class="am-icon-angle-right am-icon-lg"></span></a>
								</div>
								<div class="clear"></div>

								<div class="new-addr-btn">
									<a href="javascript:void(0)" id="del" name="{$addresses['id']}">删除</a>
								</div>

							</li>
							</foreach>
							<!-- <div class="per-border"></div> -->
							<!-- <li class="user-addresslist">
								<div class="address-left">
									<div class="user DefaultAddr">

										<span class="buy-address-detail">   
                   <span class="buy-user">艾迪 </span>
										<span class="buy-phone">15871145629</span>
										</span>
									</div>
									<div class="default-address DefaultAddr">
										<span class="buy-line-title buy-line-title-type">收货地址：</span>
										<span class="buy--address-detail">
								   <span class="province">湖北</span>省
										<span class="city">武汉</span>市
										<span class="dist">武昌</span>区
										<span class="street">东湖路75号众环大厦2栋9层902</span>
										</span>

										</span>
									</div>
									<ins class="deftip hidden">默认地址</ins>
								</div>
								<div class="address-right">
									<span class="am-icon-angle-right am-icon-lg"></span>
								</div>
								<div class="clear"></div>

								<div class="new-addr-btn">
									<a href="#">设为默认</a>
									<span class="new-addr-bar">|</span>
									<a href="#">编辑</a>
									<span class="new-addr-bar">|</span>
									<a href="javascript:void(0);"  onclick="delClick(this);">删除</a>
								</div>

							</li> -->

						</ul>

						<div class="clear"></div>
					</div>
					<!--物流 -->
					<!-- <div class="logistics">
						<h3>选择物流方式</h3>
						<ul class="op_express_delivery_hot">
							<li data-value="yuantong" class="OP_LOG_BTN  "><i class="c-gap-right" style="background-position:0px -468px"></i>圆通<span></span></li>
							<li data-value="shentong" class="OP_LOG_BTN  "><i class="c-gap-right" style="background-position:0px -1008px"></i>申通<span></span></li>
							<li data-value="yunda" class="OP_LOG_BTN  "><i class="c-gap-right" style="background-position:0px -576px"></i>韵达<span></span></li>
							<li data-value="zhongtong" class="OP_LOG_BTN op_express_delivery_hot_last "><i class="c-gap-right" style="background-position:0px -324px"></i>中通<span></span></li>
							<li data-value="shunfeng" class="OP_LOG_BTN  op_express_delivery_hot_bottom"><i class="c-gap-right" style="background-position:0px -180px"></i>顺丰<span></span></li>
						</ul>
					</div> -->
					<div class="clear"></div>

					<!--支付方式-->
					<div class="logistics">
						<h3>选择支付方式</h3>
						<ul class="pay-list">
							<!-- <li class="pay card"><img src="__PUBLIC__/Homes/images/wangyin.jpg" />银联<span></span></li>
							<li class="pay qq"><img src="__PUBLIC__/Homes/images/weizhifu.jpg" />微信<span></span></li> -->
							<li class="pay taobao"><img src="__PUBLIC__/Homes/images/zhifubao.jpg" />支付宝<span></span></li>
						</ul>
					</div>
					<div class="clear"></div>

					<!--订单 -->
					<div class="concent">
						<div id="payTable">
							<h3>确认订单信息</h3>
							<div class="cart-table-th">
								<div class="wp">

									<div class="th th-item">
										<div class="td-inner">商品信息</div>
									</div>
									<div class="th th-price">
										<div class="td-inner">单价</div>
									</div>
									<div class="th th-amount">
										<div class="td-inner">数量</div>
									</div>
									<div class="th th-sum">
										<div class="td-inner">金额</div>
									</div>
									<!-- <div class="th th-oplist">
										<div class="td-inner">配送方式</div>
									</div> -->

								</div>
							</div>
							<div class="clear"></div>

							<tr class="item-list">
								<div class="bundle  bundle-last">

									<div class="bundle-main">
										<volist name="row" id="shop">
										<ul class="item-content clearfix">
											<div class="pay-phone">
												<li class="td td-item">
													<div class="item-pic">
														<a href="#" class="J_MakePoint">
															<img src="__ROOT__{$shop['picname']}" class="itempic J_ItemImg"></a>
													</div>
													<div class="item-info">
														<div class="item-basic-info">
															<a href="#" class="item-title J_MakePoint" data-point="tbcart.8.11">{$shop['descr']}</a>
														</div>
													</div>
												</li>
												<li class="td td-info">
													<div class="item-props">
														<span class="sku-line">{$shop['color']}</span>
														<span class="sku-line">包装：裸装</span>
													</div>
												</li>
												<li class="td td-price">
													<div class="item-price price-promo-promo">
														<div class="price-content">
															￥<em class="J_Price price-now">{$shop['cprice']}</em>
														</div>
													</div>
												</li>
											</div>
											<li class="td td-amount">
												<div class="amount-wrapper ">
													<div class="item-amount ">
														<span class="phone-title">购买数量</span>
														<div class="sl">
															<!-- <input class="min am-btn" name="" type="button" value="-" /> -->
															<!-- <input class="text_box" name="" type="text" value="3" style="width:30px;" /> -->
															<span class="text_box" name="num" style="width:30px;text-align:center;">{$shop['num']}</span>
															<!-- <input class="add am-btn" name="" type="button" value="+" /> -->
														</div>
													</div>
												</div>
											</li>
											<li class="td td-sum">
												<div class="td-inner">
													￥<em tabindex="0" class="J_ItemSum number">{$shop['num']*$shop['cprice']}</em>
												</div>
											</li>
											<!-- <li class="td td-oplist">
												<div class="td-inner">
													<span class="phone-title">配送方式</span>
													<div class="pay-logis">
														快递<b class="sys_item_freprice">10</b>元
													</div>
												</div>
											</li> -->

										</ul>
										</volist>
										<div class="clear"></div>

									</div>
							</tr>
							<div class="clear"></div>
							</div>

						
							</div>
							<div class="clear"></div>
							<div class="pay-total">
						<!--留言-->
							
							<!--优惠券 -->
							
							<div class="clear"></div>
							</div>
							<!--含运费小计 -->
							

							<!--信息 -->
							<div class="order-go clearfix">
								<div class="pay-confirm clearfix">
									<div class="box">
										<div tabindex="0" id="holyshit267" class="realPay"><em class="t">实付款：</em>
											<span class="price g_price ">
                                    <span>¥</span> <em class="style-large-bold-red " id="J_ActualFee">{$all}</em>
											</span>
										</div>

										<div id="holyshit268" class="pay-address">

											<p class="buy-footer-address">
												<span class="buy-line-title">收货人:</span>
												<span class="buy-address-detail">   
                                         		<span class="buy-user" id="name"> </span>
												<!-- <span class="buy-phone" id="phone"></span> -->
												</span>
												
											</p>
											<p class="buy-footer-address">
												
												<span class="buy-address-detail">
												<span class="buy-line-title">手机号:</span>
												<span class="buy-phone" id="phone"></span>
												</span>
											</p>
											<p class="buy-footer-address">
												<span class="buy-line-title buy-line-title-type">寄送至：</span>
												<span class="buy--address-detail">
								   				<!-- <span class="province">湖北</span>省
												<span class="city">武汉</span>市
												<span class="dist">洪山</span>区 -->
												<span id="address"></span>
												<span class="street" id="street"></span>
												</span>
												</span>
											</p>
										</div>
									</div>

									<div id="holyshit269" class="submitOrder">
										<div class="go-btn-wrap">
											<a id="J_Go" href="javascript:void(0)" class="btn-go" tabindex="0" title="点击此按钮，提交订单">提交订单</a>
										</div>
									</div>
									<div class="clear"></div>
								</div>
							</div>
						</div>

						<div class="clear"></div>
					</div>
				</div>
				<!-- <div class="footer"> -->
				<!-- 尾部 -->
					<include file="Public/pfooter"/>
					<!-- 尾部 -->
					<!-- <div class="footer-hd">
						<p>
							<a href="#">恒望科技</a>
							<b>|</b>
							<a href="#">商城首页</a>
							<b>|</b>
							<a href="#">支付宝</a>
							<b>|</b>
							<a href="#">物流</a>
						</p>
					</div> -->
					<!-- <div class="footer-bd">
						<p>
							<a href="#">关于恒望</a>
							<a href="#">合作伙伴</a>
							<a href="#">联系我们</a>
							<a href="#">网站地图</a>
							<em>© 2015-2025 Hengwang.com 版权所有. 更多模板 <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></em>
						</p>
					</div> -->
				<!-- </div> -->
			</div>
			<div class="theme-popover-mask"></div>
			<div class="theme-popover">

				<!--标题 -->
				<div class="am-cf am-padding">
					<div class="am-fl am-cf">
					<strong class="am-text-danger am-text-lg">新增地址</strong> / <small>Add address</small></div>
					<div class="am-form-group theme-poptit">
						<div class="am-btn am-btn-danger close" style="float:right;">&times;</div>
					</div>
				</div>
				<hr/>

				<div class="am-u-md-12">
					<form class="am-form am-form-horizontal" action="__MODULE__/Pay/insert" method="post">

						<div class="am-form-group">
							<label for="user-name" class="am-form-label">收货人</label>
							<div class="am-form-content">
								<input type="text" name="name" placeholder="收货人">
							</div>
						</div>

						<div class="am-form-group">
							<label for="user-phone" class="am-form-label">手机号码</label>
							<div class="am-form-content">
								<input name="phone" placeholder="手机号必填" type="text">
							</div>
						</div>

						<div class="am-form-group">
							<label for="user-phone" class="am-form-label">地址:</label>
							<div class="am-form-content address">
								<select id="cid">
									<option value="">--请选择--</option>
								</select>
							</div>
						</div>

						<div class="am-form-group">
							<label for="user-intro" class="am-form-label">详细地址</label>
							<div class="am-form-content">
								<input class="" rows="3" type="text" id="user-intro" placeholder="输入详细街道" name="street">
							</div>
						</div>
						<div class="am-form-group">
							<label for="user-code" class="am-form-label">邮编</label>
							<div class="am-form-content">
								<input name="code" placeholder="邮编" type="text">
							</div>
						</div>
						<input type="hidden" name="address" value="">
						<div class="am-form-group theme-poptit">
							<div class="am-u-sm-9 am-u-sm-push-3">
								<input type="submit" class="am-btn am-btn-danger" value="添加" id="ss">
								<div class="am-btn am-btn-danger close">取消</div>
							</div>
						</div>
					</form>
				</div>

			</div>

			<div class="clear"></div>
	</body>
	<script type="text/javascript">
	$.ajax({
		'url':'__MODULE__/Pay/address',
		'type':'get',
		'data':{upid:0},
		'dataType':'json',
		success:
		function(data){
			// alert(data);
			//遍历data
			for(var i=0;i<data.length;i++){
				// alert(data[i].name);
				//把遍历出来的数据添加到下拉选项里
				var info='<option value="'+data[i].id+'">'+data[i].name+'</option>';
				// alert(info);
				//把带有数据的下拉选项添加到select元素里
				$("#cid").append(info);
			}
			
		},
		error:
		function(){
			alert('Ajax响应失败');
		}
	})

	//其他级别
	$("select").live('change',function(){
		// alert('ssss');
		//获取父级id 当做附加参数
		o=$(this);
		//清除
		o.nextAll("select").remove();
		id=o.val();
		// alert(id);
		//ajax
		$.ajax({
			'url':'__MODULE__/Pay/address',
			'type':'get',
			'data':{upid:id},
			'dataType':'json',
			success:
			function(data){
				//创建select
				select=$("<select></select>");
				// alert(data);
				if(data.length>0){
				//遍历
					for(var i=0;i<data.length;i++){
						//把遍历出来数据添加到option
						info='<option value="'+data[i].id+'">'+data[i].name+'</option>';
						// alert(info);
						// $("#mid").append(info);
						//把当前info数据添加到创建的select
						select.append(info);
						
					}
					//把带有数据的select 追加
					o.after(select);
				
				}
			}


		})
	})

	//获取城市级联地址信息
	$("#ss").click(function(){
		arr=[];
		$("select").each(function(){
			//获取选中地址的value值
			v=$(this).find("option:selected").html();
			arr.push(v);
			// alert();
		})
		// alert(arr);
		//给隐藏域赋值
		$("input[name='address']").val(arr);

	})

	// //选中收货地址 获取选中的收货地址id 方便生成订单
	// $("").click(function(){
	// 	// alert('ss');
	// 	$(this).siblings().removeClass('active');
	// 	$(this).addClass('active');
	// 	address_id=$(this).attr("uid");
	// 	// alert(address_id);
	// })
	// 地址与提交同步
	$("#li").live('click',function(){
		// alert(length);
		id=$(this).attr('name');
		// alert(id);
		ad=$(this);
		if(id==null){
			alert("请选择地址");
			$("#J_Go").attr('href',"javascript:void(0)");
		}else{
			$("#J_Go").attr('href',"__MODULE__/Bycar/dopayes?id="+id);
		}
		// $("#J_Go").attr('href',"__MODULE__/Bycar/payes?id="+id);
		$.post('__MODULE__/Pay/checkpay',{id:id},function(data){
			// ad.parents().next().next().next().next().next().find("span[name='address']").html(data['address']);
			$("#address").html(data['address']);
			$("#street").html(data['street']);
			$("#name").html(data['name']);
			$("#phone").html(data['phone']);

		},'json');
	})

	// ajax删除
	$("#del").live('click',function(){
		id=$(this).attr('name');
		// alert(id);
		dd=$(this);
		s=confirm("你确定删除吗?");
		if(s){  
		  //Ajax
		  $.post("__MODULE__/Pay/del",{id:id},function(data){
		    if(data==1){
		      // 清除选中的html样式
		        
	            	dd.parent().parent().remove();
					// window.location.reload();//强制刷新

		        // alert(a);
		      // alert('删除成功');
		    }else{
		      alert(data);
		    }
		  });
		}
	})
	$("#J_Go").click(function(){
		if($(".user-addresslist").hasClass('defaultAddr')){
			
		}else{
			alert('请先选择地址');
		}
	})
	
</script>
</html>